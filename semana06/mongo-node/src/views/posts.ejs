<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SocialHub - Posts</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üê±</text></svg>">
  <!-- Materialize CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
  <!-- Google Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Custom CSS -->
  <link href="/css/posts.css" rel="stylesheet">
</head>
<body class="main-container">

  <nav class="navbar-modern">
    <div class="nav-wrapper container">
      <a href="/" class="brand-logo">
        <span>üê±</span>
        <span class="brand-text">SocialHub</span>
      </a>
      <ul class="right">
        <li><a href="/posts" class="nav-link"><i class="material-icons left">home</i>Inicio</a></li>
        <li><a href="/posts/create" class="nav-link nav-create"><i class="material-icons left">add_circle</i>Crear Post</a></li>
      </ul>
    </div>
  </nav>

  <div class="container" style="margin-top: 15px; max-width: 600px;"> <!-- Reducido de 20px a 15px -->

    <% if (posts && posts.length > 0) { %>
      <% posts.forEach(post => { %>
        <div class="card post-card-modern">
          <!-- Header del Post -->
          <div class="card-content post-header-modern">
            <div class="row valign-wrapper">
              <div class="col s2">
                <div class="profile-avatar">
                  <%= (post.user ? (post.user.name.charAt(0) + post.user.lastName.charAt(0)) : 'A').toUpperCase() %>
                </div>
              </div>
              <div class="col s8 user-info">
                <h6><%= post.user ? (post.user.name + ' ' + post.user.lastName) : 'Usuario An√≥nimo' %></h6>
                <p class="post-date">
                  <%= post.createdAt ? new Date(post.createdAt).toLocaleDateString('es-ES', {
                    month: 'short', day: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                  }) : '' %>
                </p>
              </div>
              <div class="col s2 right-align">
                <a class="dropdown-trigger btn-flat" href="#" data-target="dropdown-<%= post._id %>">
                  <i class="material-icons grey-text">more_vert</i>
                </a>
                <ul id="dropdown-<%= post._id %>" class="dropdown-content">
                  <li><a href="/posts/edit/<%= post._id %>"><i class="material-icons left">edit</i>Editar</a></li>
                  <li class="divider"></li>
                  <li>
                    <a href="#" onclick="deletePost('<%= post._id %>')" class="red-text">
                      <i class="material-icons left red-text">delete</i>Eliminar
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Contenido del Post -->
          <div class="card-content post-content-modern">
            <h5 class="post-title"><%= post.title %></h5>
            <p class="post-text"><%= post.content %></p>
            
            <% if (post.imageUrl) { %>
              <img src="<%= post.imageUrl %>" alt="Imagen del post" class="responsive-img materialboxed post-image" style="max-height: 300px; object-fit: cover;">
            <% } %>
            
            <% if (post.hashtag && post.hashtag.length > 0) { %>
              <div style="margin-top: 16px;">
                <% post.hashtag.forEach(tag => { %>
                  <span class="chip hashtag-modern">
                    #<%= tag %>
                  </span>
                <% }); %>
              </div>
            <% } %>
          </div>

          <!-- Acciones del Post -->
          <div class="card-action post-actions-modern">
            <a href="#" class="action-btn">
              <i class="material-icons left">favorite_border</i>Me gusta
            </a>
            <a href="#" class="action-btn">
              <i class="material-icons left">chat_bubble_outline</i>Comentar
            </a>
            <a href="#" class="action-btn">
              <i class="material-icons left">share</i>Compartir
            </a>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <div class="empty-state">
        <i class="material-icons empty-icon">explore</i>
        <h5 class="empty-title">¬°Tu feed est√° esperando contenido!</h5>
        <p class="empty-subtitle">S√© el primero en compartir algo incre√≠ble con la comunidad</p>
        <a href="/posts/create" class="btn-large waves-effect" style="background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 25px;">
          <i class="material-icons left">create</i>Crear primer post
        </a>
      </div>
    <% } %>
  </div>

  <!-- Bot√≥n flotante para crear post -->
  <div class="fixed-action-btn floating-btn">
    <a href="/posts/create" class="btn-floating btn-large fab-modern">
      <i class="large material-icons">add</i>
    </a>
  </div>
      <i class="large material-icons">add</i>
    </a>
  </div>

  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <h4>¬øEliminar post?</h4>
      <p>Esta acci√≥n no se puede deshacer. ¬øEst√°s seguro de que quieres eliminar este post?</p>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancelar</a>
      <a href="#!" id="confirmDelete" class="modal-close waves-effect waves-red btn-flat red-text">Eliminar</a>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      M.AutoInit();
      
      var elems = document.querySelectorAll('select');
      M.FormSelect.init(elems);
      
      var dropdowns = document.querySelectorAll('.dropdown-trigger');
      M.Dropdown.init(dropdowns);
      
      var modals = document.querySelectorAll('.modal');
      M.Modal.init(modals);
      
      M.textareaAutoResize(document.querySelectorAll('textarea'));
    });

    let postToDelete = null;

    function deletePost(postId) {
      postToDelete = postId;
      var modal = M.Modal.getInstance(document.getElementById('deleteModal'));
      modal.open();
    }

    document.getElementById('confirmDelete').addEventListener('click', function() {
      if (postToDelete) {
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = '/posts/delete/' + postToDelete;
        document.body.appendChild(form);
        form.submit();
      }
    });
  </script>
</body>
</html>
